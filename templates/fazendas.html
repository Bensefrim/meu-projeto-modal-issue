{% extends "base.html" %}

{% block title %}Fazendas - Sistema de Controle de Pecuária{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 col-md-6 mb-2 mb-md-0">
        <h1>Gerenciamento de Fazendas</h1>
    </div>
    <div class="col-12 col-md-6 text-center text-md-end">
        <button type="button" class="btn btn-primary d-none d-sm-inline-block" onclick="showFazendaModal()">
            <i class="fas fa-plus"></i> Nova Fazenda
        </button>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <div class="row">
            <div class="col-12 col-md-6 mb-2 mb-md-0">
                <h5 class="card-title">Fazendas Cadastradas</h5>
            </div>
            <div class="col-12 col-md-6">
                <div class="input-group">
                    <input type="text" id="busca-fazenda" class="form-control" placeholder="Buscar fazenda...">
                    <button class="btn btn-outline-secondary" type="button" onclick="buscarFazendas()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body p-0 p-sm-3">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Município</th>
                        <th class="hide-xs">Estado</th>
                        <th class="hide-xs">Área Total (ha)</th>
                        <th class="hide-xs">Responsável</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="fazendas-table-body">
                    <!-- Dados serão carregados via JavaScript -->
                </tbody>
            </table>
        </div>
        <div id="fazendas-loading" class="text-center py-3">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="mt-2">Carregando fazendas...</p>
        </div>
        <div id="fazendas-empty" class="text-center py-3" style="display: none;">
            <p>Nenhuma fazenda encontrada.</p>
        </div>
    </div>
</div>

<!-- Botão flutuante de ação (FAB) para dispositivos móveis - Novo estilo -->
<div class="custom-fab-container d-block d-sm-none">
    <button class="custom-fab-button" onclick="showFazendaModal()" aria-label="Adicionar Nova Fazenda" id="custom-fab-fazenda">
        <i class="fas fa-plus"></i>
    </button>
</div>

<!-- Script para garantir que o botão FAB seja exibido corretamente -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fabButton = document.getElementById('custom-fab-fazenda');
        const modalElement = document.getElementById('fazendaModal');
        
        if (!fabButton || !modalElement) return;
        
        // Aplicar estilos ao botão FAB
        setTimeout(function() {
            if (fabButton) {
                fabButton.style.width = '60px';
                fabButton.style.height = '60px';
                fabButton.style.borderRadius = '50%';
                fabButton.style.backgroundColor = '#2c7a4e';
                fabButton.style.display = 'flex';
                fabButton.style.alignItems = 'center';
                fabButton.style.justifyContent = 'center';
                
                const icon = fabButton.querySelector('i');
                if (icon) {
                    icon.style.fontSize = '2rem';
                }
            }
        }, 500);
        
        // Esconder o botão FAB quando o modal estiver aberto
        const modal = new bootstrap.Modal(modalElement);
        
        modalElement.addEventListener('show.bs.modal', function() {
            fabButton.style.display = 'none';
        });
        
        modalElement.addEventListener('hidden.bs.modal', function() {
            if (window.innerWidth < 576) { // Apenas em telas móveis
                fabButton.style.display = 'flex';
            }
        });
        
        // Verificar o tamanho da tela ao redimensionar
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 576) {
                fabButton.style.display = 'none';
            } else if (!modal._isShown) { // Mostrar apenas se o modal não estiver aberto
                fabButton.style.display = 'flex';
            }
        });
        
        // Verificação inicial
        if (window.innerWidth >= 576) {
            fabButton.style.display = 'none';
        }
    });
</script>

<!-- Modal de Cadastro/Edição de Fazenda -->
<div class="modal fade" id="fazendaModal" tabindex="-1" aria-labelledby="fazendaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fazendaModalLabel">Nova Fazenda</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <form id="fazenda-form">
                    <input type="hidden" id="fazenda-id">
                    
                    <div class="row mb-3">
                        <div class="col-12 col-md-6 mb-2 mb-md-0">
                            <label for="fazenda-nome" class="form-label">Nome da Fazenda *</label>
                            <input type="text" class="form-control" id="fazenda-nome" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label for="fazenda-responsavel" class="form-label">Responsável</label>
                            <input type="text" class="form-control" id="fazenda-responsavel">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="fazenda-endereco" class="form-label">Endereço</label>
                            <input type="text" class="form-control" id="fazenda-endereco">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12 col-md-6 mb-2 mb-md-0">
                            <label for="fazenda-municipio" class="form-label">Município *</label>
                            <input type="text" class="form-control" id="fazenda-municipio" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label for="fazenda-estado" class="form-label">Estado *</label>
                            <select class="form-select" id="fazenda-estado" required>
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12 col-sm-4 mb-2 mb-sm-0">
                            <label for="fazenda-area-total" class="form-label">Área Total (ha)</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="fazenda-area-total">
                        </div>
                        <div class="col-12 col-sm-4 mb-2 mb-sm-0">
                            <label for="fazenda-area-pastagem" class="form-label">Área de Pastagem (ha)</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="fazenda-area-pastagem">
                        </div>
                        <div class="col-12 col-sm-4">
                            <label for="fazenda-capacidade-ua" class="form-label">Capacidade (UA)</label>
                            <input type="number" min="0" class="form-control" id="fazenda-capacidade-ua">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12 col-md-6 mb-2 mb-md-0">
                            <label for="fazenda-telefone" class="form-label">Telefone</label>
                            <input type="text" class="form-control" id="fazenda-telefone">
                        </div>
                        <div class="col-12 col-md-6">
                            <label for="fazenda-email" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="fazenda-email">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="fazenda-observacoes" class="form-label">Observações</label>
                        <textarea class="form-control" id="fazenda-observacoes" rows="3"></textarea>
                    </div>
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="fazenda-ativo" checked>
                        <label class="form-check-label" for="fazenda-ativo">Ativo</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="salvarFazenda()">Salvar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Exclusão</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir a fazenda <strong id="delete-fazenda-nome"></strong>?</p>
                <p class="text-danger">Esta ação não poderá ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" onclick="confirmarExclusaoFazenda()">Excluir</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalhes da Fazenda (para dispositivos móveis) -->
<div class="modal fade" id="detalhesFazendaModal" tabindex="-1" aria-labelledby="detalhesFazendaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detalhesFazendaModalLabel">Detalhes da Fazenda</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title" id="detalhe-fazenda-nome"></h5>
                        <p class="card-text mb-1">
                            <strong>Status:</strong> <span id="detalhe-fazenda-status"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Município:</strong> <span id="detalhe-fazenda-municipio"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Estado:</strong> <span id="detalhe-fazenda-estado"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Endereço:</strong> <span id="detalhe-fazenda-endereco"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Área Total:</strong> <span id="detalhe-fazenda-area-total"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Área de Pastagem:</strong> <span id="detalhe-fazenda-area-pastagem"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Capacidade (UA):</strong> <span id="detalhe-fazenda-capacidade-ua"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Responsável:</strong> <span id="detalhe-fazenda-responsavel"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Telefone:</strong> <span id="detalhe-fazenda-telefone"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>E-mail:</strong> <span id="detalhe-fazenda-email"></span>
                        </p>
                        <p class="card-text mb-1">
                            <strong>Observações:</strong> <span id="detalhe-fazenda-observacoes"></span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-primary" onclick="editarFazendaDoModal()">Editar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/fazendas.js"></script>
{% endblock %}